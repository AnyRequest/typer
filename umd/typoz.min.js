!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Typoz=e():t.Typoz=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function n(t,e){for(const i of Object.keys(e))"string"==typeof t[i]||"number"==typeof t[i]||"boolean"==typeof t[i]||t[i]instanceof Array?t[i]=e[i]:n(t[i],e[i])}function i(t,e,n){const i=document.createElement(t);return i.innerHTML=e,n&&i.setAttribute(n.name,n.value),i}function s({blink:t,blinkTime:e=1,content:n="",color:i="#56565656",dir:s="vertical",size:r=1,distance:o=.1},h,a=!1){const c=t?"@keyframes cursor-blink { 100% { opacity: 0; } }":"",d=t?`animation: cursor-blink ${e}s steps(2) infinite;`:"animation: none";return a?`[typoz-name${h?`="${h}"`:""}]::before { content: '　'; display: inline-block; height: 1em; width: 1px; user-select: none; pointer-events: none; color: transparent; background-color: transparent; } [typoz-name${h?`="${h}"`:""}] { } [typoz-name${h?`="${h}"`:""}]>[typoz-cursor]::after { box-sizing: content-box; display: inline-block; content: "${n}"; width: 0px; height: 1em; border-left: 1px solid #565656; /* margin-left: ${o}em; */ line-height: inherit;  ${d} }${c}`:`[typoz-name${h?`="${h}"`:""}]::before { content: '　'; display: inline-block; height: 1em; width: 1px; user-select: none; pointer-events: none; color: transparent; background-color: transparent; } [typoz-name${h?`="${h}"`:""}] { } [typoz-name${h?`="${h}"`:""}]::after { display: inline-block; content: "${n}"; ${{vertical:`height: ${r}em; width: calc(${r}em * 0.25);`,horizontal:` width: ${.8*r}em; height: calc(${.8*r}em * 0.35);`}[s]} /* margin-left: ${o}em; */ line-height: inherit; background-color: ${i}; ${d} }${c}`}function r(t){return document.querySelector(t)}function o(t){if(document.head.querySelector("[typoz-styles]"))document.head.querySelector("[typoz-styles]").innerHTML+=t;else{const e=i("style",t);e.setAttribute("typoz-styles",""),document.head.append(e)}}function h(t){return JSON.parse(JSON.stringify(t))}function a(){return"xyxyxx-xyyx-xxy-xxyyxxyxyyxy1xxyyxyxxx0xxyyy".replace(/x|y/g,(t=>{const e=t=>t[Math.floor(Math.random()*t.length)];switch(t){case"x":return e("abcdefghijklmnopqrstuvwxyz");case"y":return e("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")}}))}t.d(e,{default:()=>g});class c{static id=0;id;name;typingList=[];config;before=0;element;isStarted=!1;injectStyle;order=0;stop=!1;play;constructor(t,e,n){this.id=++c.id,this.element=t,this.name=a(),this.config=e,this.typingList=n.filter((t=>t&&t.length>0&&t[0].length>0&&t[0][0].length>0)),this.setup()}orderUp(){this.order=(this.order+1)%this.typingList.length||0}setup(){Object.freeze(this.typingList),Object.freeze(this.config),this.element.innerHTML="",this.element.setAttribute("typoz-id",""+this.id),this.element.setAttribute("typoz-name",this.name),this.element.setAttribute("typoz-processed",""),this.injectStyle=s(this.config.style.cursor,this.name)}copyCurrent(){return JSON.parse(JSON.stringify(this.typingList[this.order]))}resume(){this.play(!0),this.stop=!1}pause(){this.stop=!0}clear(){this.isStarted=!1}destroy(){this.pause(),this.clear(),this.element.innerHTML=this.element.typings[0],this.typingList=[]}wait(t=0){return new Promise((e=>{this.stop?this.play=e:setTimeout((()=>{e(!0)}),1e3*t)}))}run(){this.isStarted=!0,this.render()}renderEraseDivide(t){return new Promise((e=>{const n=[...this.element.innerText].map((t=>i("span",t).outerHTML));let s=n.length,r=t.pop();const o=setInterval((async()=>{if(this.stop&&await this.wait(),0===r.length){if(0===t.length)return clearInterval(o),this.element.innerText="",void e(!0);r=t.pop(),s-=1,this.element.innerHTML="",this.element.innerHTML=n.slice(0,s).join("")}else this.element.innerHTML=[...n.slice(0,s-1),i("span",r.pop()).outerHTML].join("")}),1/this.config.speed.erase*100)}))}renderWriteDivide(t){return new Promise((e=>{let n=0;const s=[];let r=t.shift();const o=setInterval((async()=>{this.stop&&await this.wait(),0===r.length?0===t.length?(clearInterval(o),this.element.innerHTML=s.join(""),e(!0)):(r=t.shift(),n+=1):(s[n]=i("span",r.shift()).outerHTML,this.element.innerHTML=s.join(""))}),1/this.config.speed.write*100)}))}renderErase(t){return new Promise((e=>{let n=this.element.innerText.length;const i=this.element.innerText;let s=t.pop();const r=setInterval((async()=>{if(this.stop&&await this.wait(),0===s.length){if(0===t.length)return clearInterval(r),this.element.innerText="",void e(!0);s=t.pop(),n-=1,this.element.innerText=i.slice(0,n)}else this.element.innerText=i.slice(0,n-1)+s.pop()}),1/this.config.speed.erase*100)}))}renderWrite(t){return new Promise((e=>{let n=0;const i=[];let s=t.shift();const r=setInterval((async()=>{this.stop&&await this.wait(),0===s.length?0===t.length?(clearInterval(r),this.element.innerText=i.join(""),e(!0)):(s=t.shift(),n+=1):(i[n]=s.shift(),this.element.innerText=i.join(""))}),1/this.config.speed.write*100)}))}async render(){!1!==this.isStarted&&(this.orderUp(),this.config.mode.divide?(await this.renderWriteDivide([...this.copyCurrent()]),await this.wait(this.config.delay),this.config.mode.erase&&(await this.renderEraseDivide([...this.copyCurrent()]),await this.wait(this.config.delay))):(await this.renderWrite([...this.copyCurrent()]),this.config.mode.erase&&(await this.renderErase([...this.copyCurrent()]),await this.wait(this.config.delay))),this.isStarted&&this.render())}}class d{}class l{onset=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];nucleus=["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];coda=["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];gapLetterWithWord=18816;startKorPoint=12593;startKorWordPoint=44032;changeOnsetPoint=this.coda.length*this.nucleus.length;korInitializePoint(t){if(!this.isKorean(t))throw new TypeError("required only korean.");return t.charCodeAt(0)-this.startKorWordPoint}onsetIndex(t){return Math.floor(this.korInitializePoint(t)/this.changeOnsetPoint)}nucleusIndex(t){return Math.floor(this.korInitializePoint(t)/this.coda.length%this.nucleus.length)}codeIndex(t){return Math.floor(this.korInitializePoint(t)%this.coda.length)}getOnset(t){return this.onset[this.onsetIndex(t)]}getNucleus(t){return this.nucleus[this.nucleusIndex(t)]}getCoda(t){return this.coda[this.codeIndex(t)]}isKorean(t){return!!String(t).match(/[ㄱ-ㅎ가-힣]/g)}wordToLetters(t){return this.wordToLettersWithEmpty(t).filter((t=>t))}wordToLettersWithEmpty(t){return[this.getOnset(t),this.getNucleus(t),this.getCoda(t)]}getOnsetIndex(t){return this.onset.indexOf(t)}getNucleusIndex(t){return this.nucleus.indexOf(t)}getCodaIndex(t){return this.coda.indexOf(t)}getOnsetCode(t){return this.getOnsetIndex(t)*this.changeOnsetPoint}getNucleusCode(t){return this.getNucleusIndex(t)%this.nucleus.length*this.coda.length}getCodaCode(t){return this.getCodaIndex(t)%this.coda.length}getWordCode(t){let e=0;return t[0]&&(e+=this.getOnsetCode(t[0])),t[1]&&(e+=this.getNucleusCode(t[1])),t[2]&&(e+=this.getCodaCode(t[2])),e+this.startKorWordPoint}lettersToWord(t){const e=this.getWordCode(t),n=String.fromCharCode(e);return 1===t.length?t[0]:n}}class p extends d{koreanParser;constructor(){super(),this.koreanParser=new l}wordToLetters(t){return this.wordToLettersWithEmpty(t).filter((t=>t))}wordToLettersWithEmpty(t){return[t,"",""]}categorizing(t){const e=[];for(const n of t.trim())if(this.koreanParser.isKorean(n)){const t=this.koreanParser.wordToLetters(n);e.push(t)}else{const t=this.wordToLetters(n);e.push(t)}return e}categorizingWithEmpty(t){const e=[];for(const n of t)if(this.koreanParser.isKorean(n)){const t=this.koreanParser.wordToLettersWithEmpty(n);e.push(t)}else{const t=this.wordToLettersWithEmpty(n);e.push(t)}return e}getTypingFlow(t){return t.map((t=>{const e=[];if(t.some(this.koreanParser.isKorean))for(let n=1;n<=t.length;n++){const i=t.slice(0,n),s=this.koreanParser.lettersToWord(i);e.push(s)}else e.push(...t);return e}))}parse(t){if(""!==t){const e=this.categorizing(t);return this.getTypingFlow(e)}return[]}}const u={autoRender:!0,mode:{erase:!0,realTyping:!1,divide:!0},speed:{write:1,erase:5},delay:3,nodes:[],querySelector:".typoz",style:{cursor:{blink:!0,blinkTime:1,content:"",color:"#56565656",dir:"vertical",size:1,distance:.1}}};class y{static instance(t){return new y(t)}static id=0;parser;id;name;config=u;typeNode;taskQueue=[];pointer=0;content=[];constructor(t){this.parser=t}wait(t){return new Promise((e=>{setTimeout((()=>{e(t)}),t)}))}select(t){const e=r(t);return y.id+=1,this.id=y.id,this.typeNode=e,this.name=a(),this}conf(t=u){return t&&n(this.config,t),o(s(this.config.style.cursor,this.name,!0)),this.typeNode.setAttribute("typoz-id",""+this.id),this.typeNode.setAttribute("typoz-name",this.name),this.typeNode.setAttribute("typoz-node-builder",""),this.typeNode.setAttribute("typoz-processed",""),this.typeNode.innerHTML="",this}getCurrentRenderContentLength(){return this.content.length}cursorUpdate(t){this.pointer+t>=0&&this.pointer+t<=this.content.length&&(this.pointer+=t)}pause(t){return this.addTask((async()=>await this.wait(1e3*t))),this}commonWrite(t){this.addTask((async()=>(this.content=this.content.slice(0,this.pointer).concat(t).concat(this.content.slice(this.pointer)),this.cursorUpdate(1),this.renderContent(),await this.wait(1/this.config.speed.write*100))))}addplace(t,e){return this.addTask((async()=>(this.content=this.content.slice(0,this.pointer).concat(e).concat(this.content.slice(this.pointer)),this.cursorUpdate(t),this.renderContent(),await this.wait(1/this.config.speed.write*100)))),this}replace(t,e){return this.addTask((async()=>(this.content.splice(this.pointer,1,e),this.cursorUpdate(t),this.renderContent(),await this.wait(1/this.config.speed.write*100)))),this}write(t,e){for(const n of t)if(this.parser.koreanParser.isKorean(n)){const t=this.parser.categorizing(n),i=this.parser.getTypingFlow(t)[0];for(let t=0;t<i.length;t++){const n=i[t];0===t?this.addTask((async()=>(this.content=this.content.slice(0,this.pointer).concat(n).concat(this.content.slice(this.pointer)),this.renderContent(),await this.wait(e?1/e*100:1/this.config.speed.write*100)))):this.addTask((async()=>(this.content.splice(this.pointer,1,n),this.renderContent(),await this.wait(e?1/e*100:1/this.config.speed.write*100))))}this.addTask((async()=>(this.cursorUpdate(1),this.renderContent(),await this.wait(e?1/e*100:1/this.config.speed.write*100))))}else this.commonWrite(n);return this}erase(t=1,e){for(let n=0;n<t;n++)this.addTask((async()=>(this.cursorUpdate(-1),this.content.splice(this.pointer,1),this.renderContent(),await this.wait(e?1/e*100:1/(this.config.speed.erase/2)*100))));return this}allErase(t){return this.addTask((async()=>{for(;this.content.length>0;)this.cursorUpdate(-1),this.content.pop(),this.renderContent(),await this.wait(t?1/(t/2)/5*100:1/(this.config.speed.erase/2)/5*100);return t?1/(t/2)/5*100:1/(this.config.speed.erase/2)/5*100})),this}move(t,e){const n=Math.abs(t),i=Math.floor(Math.abs(t)/t);for(let t=0;t<n;t++)this.addTask((async()=>(this.cursorUpdate(i),this.renderContent(),await this.wait(e?1/e*100:100*this.config.delay))));return this}addTask(t){this.taskQueue.push(t)}async run(){for(const t of this.taskQueue)await t()}renderContent(){this.typeNode.innerHTML=this.content.map(((t,e)=>i("span",t,e===this.pointer-1?{name:"typoz-cursor",value:""}:void 0).outerHTML)).join("")}}const g=class{defaultConfig=u;parser;node(){return y.instance(this.parser)}config;typeNodes=[];constructor(){this.parser=new p}initialize(){this.config=h(this.defaultConfig)}destroy(){this.config=h(this.defaultConfig),c.id=0,y.id=0;for(const t of this.typeNodes)t.destroy();this.typeNodes=[],document.head.querySelectorAll("[typoz-styles]").forEach((t=>{t?.remove?.()}))}globalConfig(t=u){t&&n(this.config,t),this.config.autoRender&&this.render()}convert(t){return this.parser.parse(t)}bulkConvert(t){const e=[];for(const n of t)e.push(this.convert(n));return e}resume(t){if(null!=t&&"string"==typeof t){const e=this.typeNodes.find((e=>e.name===t));e&&e.resume()}else for(const t of this.typeNodes)t.resume()}pause(t){if(null!=t&&"string"==typeof t){const e=this.typeNodes.find((e=>e.name===t));e&&e.pause()}else for(const t of this.typeNodes)t.pause()}defaultRender(){const t=(e=this.config.querySelector,document.querySelectorAll([].concat(e).join(",")));var e;for(const e of[...new Set(t)]){const t=e.innerText.trim();""!==t&&(Object.hasOwn(e,"typings")||(e.typings=[]),e.typings.push(t.trim()));const n=this.convert(t),i=new c(e,e.typozConfig||JSON.parse(JSON.stringify(this.config)),[n]);this.typeNodes.push(i)}}manualRender(t){for(const e of[...new Set(t)]){const t=e.innerText.trim();""!==t&&(Object.hasOwn(e,"typings")||(e.typings=[]),e.typings.push(t.trim()));const n=this.convert(t),i=new c(e,e.typozConfig||JSON.parse(JSON.stringify(this.config)),[n]);this.typeNodes.push(i)}}getConfigNodes(){return this.config.nodes.length>0?this.config.nodes.reduce(((t,{select:e,words:i,config:s})=>{const o=r(e);if(o){if(o.setAttribute,!Object.hasOwn(o,"typozConfig")){const t=JSON.parse(JSON.stringify(this.config));n(t,s||this.config),o.typozConfig=t}const e=function(t){return t.innerText.trim()}(o);""!==e&&(Object.hasOwn(o,"typings")||(o.typings=[]),o.typings.push(e.trim())),i?.length>0&&o.typings.push(...i.map((t=>t.trim()))),t.push(o)}else console.error(new SyntaxError("not found element.",{cause:e}));return t}),[]):[]}nodesRender(){const t=this.getConfigNodes();for(const e of[...new Set(t)]){const t=[e.innerText.trim()];e.typings?.length>0&&t.push(...e.typings);const n=new c(e,e.typozConfig||JSON.parse(JSON.stringify(this.defaultConfig)),this.bulkConvert([...new Set(t)]));this.typeNodes.includes(n)||this.typeNodes.push(n)}}render(t){let e="";e+=s(this.config.style.cursor),this.defaultRender(),this.manualRender(t),this.nodesRender();for(const t of this.typeNodes)e+=t.injectStyle+"\n",t.run();o(e)}};return e.default})()));